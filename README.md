# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run dev
```

или

```
yarn
yarn dev
```

## Сборка

```
npm run build
```

или

```
yarn build
```

# Интернет-магазин «Web-Larёk»

«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component

Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`

#### Класс Api

Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter

Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` - хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

## Данные

### Интерфейсы

#### IProduct

Используется для описания структуры товара, отображаемого в каталоге магазина.

#### ICustomer

Содержит информацию о покупателе, вводимую им при оформлении заказа.

#### IOrder

Описывает структуру данных, передаваемых на сервер при создании заказа  
(формируется на основе данных ICustomer).

#### IOrderResponse

Определяет формат ответа, который возвращает сервер после обработки отправленного заказа.

---

## Модели данных

В приложении реализовано три класса-модели, каждый из которых отвечает за свою область ответственности.

---

### PRODUCT

**Назначение класса:**  
Отвечает за хранение каталога товаров и текущего выбранного для детального просмотра продукта.

**Конструктор:**  
Не принимает параметров.

#### Поля

- items: IProduct[] = [] — массив всех доступных товаров
- selectedItem: IProduct | null = null — текущий товар, открытый в подробном виде

#### Методы

- setItem(items: IProduct[]): void — сохраняет полученный массив товаров
- getItem(): IProduct[] — возвращает весь массив товаров из модели
- getItemByID(id: string): IProduct | undefined — ищет товар по идентификатору
- setSelectedItem(chosenItem: IProduct | null): void — устанавливает выбранный товар
- getSelectedItem(): IProduct | null — возвращает текущий выбранный товар

---

### CART

**Назначение класса:**  
Управляет списком товаров, добавленных пользователем в корзину.

**Конструктор:**  
Без параметров.

#### Поля

- addedProduct: IProduct[] = [] — массив товаров в корзине

#### Методы

- getItems(): IProduct[] — возвращает список товаров в корзине
- addToCart(addedProduct: IProduct): void — добавляет товар в корзину
- removeFromCart(productID: string): void — удаляет товар по id
- removeAllItems(): void — очищает корзину
- getTotalCost(): number — возвращает общую стоимость товаров
- getAmountOfItems(): number — возвращает количество товаров
- isAvailable(productID: string): boolean — проверяет наличие товара в корзине

---

### CUSTOMER

**Назначение класса:**  
Хранит и управляет персональными данными покупателя при оформлении заказа.

**Конструктор:**  
Без параметров.

#### Поля

- customerInfo: ICustomer — объект, хранящий персональные данные покупателя (тип оплаты, email, телефон, адрес). Инициализируется значениями `null`.

```ts
private customerInfo: ICustomer = {
  payment: null,
  email: null,
  phone: null,
  address: null
};
```

#### Методы

- setCustomerInfo(customerInfo: Partial<ICustomer>): void — обновляет данные покупателя (поддерживает частичное обновление)
- getCustomerInfo(): ICustomer — возвращает текущие данные покупателя
- eraseCustomerInfo(): void — сбрасывает данные к начальному состоянию
- validate(): { [key in keyof ICustomer]?: string } — проверяет корректность данных и возвращает ошибки

---

## Слой коммуникации

### ApiService

Класс, реализующий взаимодействие приложения с сервером.

**Описание:**

- Работает через композицию (в конструктор передаётся объект, соответствующий интерфейсу `IApi`)
- Использует методы `get` и `post` для работы с сервером

#### Методы

- async getProducts(): Promise<IProduct[]> — получает каталог товаров. В случае ошибки возвращает пустой массив
- postOrder(order: IOrder): Promise<IOrderResponse> — отправляет заказ на сервер и возвращает ответ в формате `IOrderResponse`

---

## Слой представления (View)

В приложении реализованы компоненты представления, отвечающие за отображение данных на странице и взаимодействие с пользователем.

### Header

**Назначение класса:**  
Шапка страницы. Содержит логотип, кнопку корзины и счётчик товаров в корзине.

**Конструктор:**  
`constructor(container: HTMLElement, events: IEvents)` — принимает контейнер и брокер событий.

#### Поля

- counterElement: HTMLElement — элемент для отображения счётчика товаров
- basketButton: HTMLElement — кнопка открытия корзины

#### Методы

- set counter(value: number): void — устанавливает значение счётчика товаров в корзине

---

### Gallery

**Назначение класса:**  
Окно вывода карточек товаров в каталоге.

**Конструктор:**  
`constructor(container: HTMLElement, events: IEvents)` — принимает контейнер и брокер событий.

#### Поля

- catalogElement: HTMLElement — контейнер для карточек товаров

#### Методы

- set catalog(items: HTMLElement[]): void — принимает массив карточек и отображает их в каталоге

---

### Modal

**Назначение класса:**  
Модальное окно для отображения различного контента (карточки товара, корзина, формы).

**Конструктор:**  
`constructor(container: HTMLElement, events: IEvents)` — принимает контейнер и брокер событий.

#### Поля

- modalElement: HTMLElement — корневой элемент модального окна
- closeButton: HTMLButtonElement — кнопка закрытия модального окна

#### Методы

- set modalContent(content: HTMLElement): void — устанавливает содержимое модального окна
- open(content: HTMLElement): void — открывает модальное окно с переданным содержимым
- close(): void — закрывает модальное окно

---

### CardDefault

**Назначение класса:**  
Абстрактный базовый класс для всех типов карточек товаров.

**Конструктор:**  
`constructor(container: HTMLElement)` — принимает контейнер карточки.

#### Поля

- title: HTMLElement — элемент для отображения названия товара
- price: HTMLElement — элемент для отображения цены товара

#### Методы

- set TitleValue(value: string): void — устанавливает название товара
- set PriceValue(value: number | null): void — устанавливает цену товара (при `null` отображается "Бесценно")

---

### CatalogCard

**Назначение класса:**  
Карточка товара, отображаемая в каталоге на главной странице.

**Конструктор:**  
`constructor(container: HTMLElement, events: IEvents)` — принимает контейнер и брокер событий.

#### Поля

- image: HTMLImageElement — изображение товара
- category: HTMLElement — элемент категории товара

#### Методы

- set categoryValue(value: string): void — устанавливает категорию товара и применяет соответствующий CSS-класс
- set imageSrc(src: string): void — устанавливает путь к изображению товара
- showPreview(id: string): void — открывает модальное окно с подробной информацией о товаре
- render(data: Partial<IProduct>): HTMLElement — отображает данные товара в карточке

---

### PreviewCard

**Назначение класса:**  
Подробная карточка товара, отображаемая в модальном окне.

**Конструктор:**  
`constructor(container: HTMLElement, events: IEvents)` — принимает контейнер и брокер событий.

#### Поля

- descriptionElement: HTMLElement — элемент для описания товара
- cardButton: HTMLButtonElement — кнопка "В корзину" / "Удалить из корзины"

#### Методы

- set description(value: string): void — устанавливает описание товара
- set buttonText(value: string): void — устанавливает текст кнопки
- set isButtonDisabled(value: boolean): void — устанавливает состояние кнопки (активна/неактивна)
- render(data: Partial<IProduct>): HTMLElement — отображает данные товара в подробной карточке

---

### CartCard

**Назначение класса:**  
Карточка товара, отображаемая в корзине.

**Конструктор:**  
`constructor(container: HTMLElement, events: IEvents)` — принимает контейнер и брокер событий.

#### Поля

- indexElement: HTMLElement — элемент для отображения порядкового номера товара
- deleteButton: HTMLButtonElement — кнопка удаления товара из корзины

#### Методы

- set index(value: number): void — устанавливает порядковый номер товара в корзине
- render(data: Partial<IProduct & { index?: number }>): HTMLElement — отображает данные товара в карточке корзины

---

### Cart (View)

**Назначение класса:**  
Компонент корзины с добавленными товарами.

**Конструктор:**  
`constructor(container: HTMLElement, events: IEvents)` — принимает контейнер и брокер событий.

#### Поля

- totalElement: HTMLElement — элемент для отображения общей стоимости
- toOrderButton: HTMLButtonElement — кнопка оформления заказа
- cartList: HTMLElement — контейнер для списка товаров

#### Методы

- set isToOrderButtonDisabled(value: boolean): void — устанавливает состояние кнопки оформления заказа
- set listItems(list: HTMLElement[]): void — устанавливает список карточек товаров (при пустом списке отображается "Корзина пуста")
- set totalPrice(price: number): void — устанавливает общую стоимость товаров в корзине

---

### Confirmation

**Назначение класса:**  
Окно подтверждения успешного оформления заказа.

**Конструктор:**  
`constructor(container: HTMLElement, events: IEvents)` — принимает контейнер и брокер событий.

#### Поля

- totalCostElement: HTMLElement — элемент для отображения суммы заказа
- closeButton: HTMLButtonElement — кнопка закрытия окна подтверждения

#### Методы

- set total(value: number): void — устанавливает сумму заказа

---

### FormDefault

**Назначение класса:**  
Абстрактный базовый класс для всех форм.

**Конструктор:**  
`constructor(container: HTMLElement)` — принимает контейнер формы.

#### Поля

- submitButton: HTMLButtonElement — кнопка отправки формы
- errorsElement: HTMLElement — элемент для отображения ошибок валидации

#### Методы

- set isButtonDisabled(value: boolean): void — устанавливает состояние кнопки отправки
- set errorMessage(message: string): void — устанавливает сообщение об ошибке

---

### FormOrder

**Назначение класса:**  
Форма для выбора способа оплаты и ввода адреса доставки (первый шаг оформления заказа).

**Конструктор:**  
`constructor(container: HTMLElement, events: IEvents)` — принимает контейнер и брокер событий.

#### Поля

- cashButton: HTMLButtonElement — кнопка выбора оплаты при получении
- cardButton: HTMLButtonElement — кнопка выбора онлайн-оплаты
- addressElement: HTMLInputElement — поле ввода адреса доставки

#### Методы

- set payment(value: PaymentType): void — устанавливает выбранный способ оплаты и обновляет визуальное состояние кнопок
- set address(value: string): void — устанавливает адрес доставки

---

### ContactsForm

**Назначение класса:**  
Форма ввода контактных данных покупателя (второй шаг оформления заказа).

**Конструктор:**  
`constructor(container: HTMLElement, events: IEvents)` — принимает контейнер и брокер событий.

#### Поля

- emailElement: HTMLInputElement — поле ввода email
- phoneElement: HTMLInputElement — поле ввода телефона

#### Методы

- set email(value: string): void — устанавливает email
- set phone(value: string): void — устанавливает телефон

---

## Описание событий

События на странице отслеживаются с помощью брокера событий (`EventEmitter`) и обрабатываются в презентере (файл `main.ts`).

### События от Моделей данных

Генерируются при изменении данных в моделях:

| Событие | Описание | Данные |
|---------|----------|--------|
| `catalog:changed` | Изменение каталога товаров | `{ items: IProduct[] }` |
| `preview:changed` | Изменение выбранного товара для просмотра | `{ item: IProduct \| null }` |
| `cart:changed` | Изменение содержимого корзины | — |
| `customer:changed` | Изменение данных покупателя | `ICustomer` |

### События от Представлений

Генерируются при действиях пользователя:

| Событие | Описание | Данные | Источник |
|---------|----------|--------|----------|
| `card:open` | Выбор карточки для просмотра | `{ id: string }` | CatalogCard |
| `card:button:clicked` | Нажатие кнопки покупки/удаления товара | `{ id: string }` | PreviewCard |
| `cart:open` | Нажатие кнопки открытия корзины | — | Header |
| `cart:item:remove` | Нажатие кнопки удаления товара из корзины | `{ id: string }` | CartCard |
| `order:make` | Нажатие кнопки оформления заказа | — | Cart |
| `order:data:submit` | Нажатие кнопки перехода ко второй форме | — | FormOrder |
| `order:confirm` | Нажатие кнопки оплаты/завершения заказа | — | ContactsForm |
| `order:completed` | Закрытие окна успешного заказа | — | Confirmation |
| `payment:chosen` | Выбор способа оплаты | `{ payment: 'online' \| 'cash' }` | FormOrder |
| `address:input` | Изменение адреса доставки | `{ address: string }` | FormOrder |
| `email:input` | Изменение email | `{ email: string }` | ContactsForm |
| `phone:input` | Изменение телефона | `{ phone: string }` | ContactsForm |
| `modal:close` | Закрытие модального окна | — | Modal |

---

## Презентер

Презентер реализован в файле `main.ts` и отвечает за связь между слоями Model и View.

**Принцип работы:**
- Презентер **не генерирует** события, только обрабатывает их
- Перерисовка View происходит только при:
  - событии от Model об изменении данных
  - открытии модального окна

**Основные обязанности:**
1. Инициализация моделей и представлений
2. Загрузка данных с сервера
3. Обработка событий от моделей (изменение данных)
4. Обработка событий от представлений (действия пользователя)
5. Подготовка данных для передачи между слоями
6. Валидация форм оформления заказа
